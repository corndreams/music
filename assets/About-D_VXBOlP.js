import{c as H,e as P,l as L,n as $,I as k,p as z,w as S,t as R,g as O}from"./index-C_b1ikHX.js";import{L as q,a as T}from"./axios-D8v4Co7E.js";import{d as I,c as o,r as x,_ as A,L as N,b as F,H as d,M as U,F as V,o as Y}from"./index-2N1GBUHz.js";import{u as j}from"./use-placeholder-CBfEajvV.js";import{a as K,H as D,b as Z}from"./on-popup-reopen-kGYa3oSh.js";import{r as G,u as J}from"./use-route-BaYZTlHS.js";const[Q,m]=H("button"),W=P({},G,{tag:L("button"),text:String,icon:String,type:L("default"),size:L("normal"),color:String,block:Boolean,plain:Boolean,round:Boolean,square:Boolean,loading:Boolean,hairline:Boolean,disabled:Boolean,iconPrefix:String,nativeType:L("button"),loadingSize:$,loadingText:String,loadingType:String,iconPosition:L("left")});var X=I({name:Q,props:W,emits:["click"],setup(t,{emit:e,slots:i}){const n=J(),a=()=>i.loading?i.loading():o(q,{size:t.loadingSize,type:t.loadingType,class:m("loading")},null),s=()=>{if(t.loading)return a();if(i.icon)return o("div",{class:m("icon")},[i.icon()]);if(t.icon)return o(k,{name:t.icon,class:m("icon"),classPrefix:t.iconPrefix},null)},r=()=>{let l;if(t.loading?l=t.loadingText:l=i.default?i.default():t.text,l)return o("span",{class:m("text")},[l])},c=()=>{const{color:l,plain:u}=t;if(l){const f={color:u?l:"white"};return u||(f.background=l),l.includes("gradient")?f.border=0:f.borderColor=l,f}},g=l=>{t.loading?z(l):t.disabled||(e("click",l),n())};return()=>{const{tag:l,type:u,size:f,block:_,round:p,plain:v,square:b,loading:y,disabled:C,hairline:B,nativeType:M,iconPosition:w}=t,E=[m([u,f,{plain:v,block:_,round:p,square:b,loading:y,disabled:C,hairline:B}]),{[K]:B}];return o(l,{type:M,class:E,style:c(),disabled:C,onClick:g},{default:()=>[o("div",{class:m("content")},[w==="left"&&s(),r(),w==="right"&&s()])]})}}});const tt=S(X),[et,h]=H("nav-bar"),it={title:String,fixed:Boolean,zIndex:$,border:R,leftText:String,rightText:String,leftDisabled:Boolean,rightDisabled:Boolean,leftArrow:Boolean,placeholder:Boolean,safeAreaInsetTop:Boolean,clickable:R};var nt=I({name:et,props:it,emits:["clickLeft","clickRight"],setup(t,{emit:e,slots:i}){const n=x(),a=j(n,h),s=u=>{t.leftDisabled||e("clickLeft",u)},r=u=>{t.rightDisabled||e("clickRight",u)},c=()=>i.left?i.left():[t.leftArrow&&o(k,{class:h("arrow"),name:"arrow-left"},null),t.leftText&&o("span",{class:h("text")},[t.leftText])],g=()=>i.right?i.right():o("span",{class:h("text")},[t.rightText]),l=()=>{const{title:u,fixed:f,border:_,zIndex:p}=t,v=O(p),b=t.leftArrow||t.leftText||i.left,y=t.rightText||i.right;return o("div",{ref:n,style:v,class:[h({fixed:f}),{[Z]:_,"van-safe-area-top":t.safeAreaInsetTop}]},[o("div",{class:h("content")},[b&&o("div",{class:[h("left",{disabled:t.leftDisabled}),t.clickable&&!t.leftDisabled?D:""],onClick:s},[c()]),o("div",{class:[h("title"),"van-ellipsis"]},[i.title?i.title():u]),y&&o("div",{class:[h("right",{disabled:t.rightDisabled}),t.clickable&&!t.rightDisabled?D:""],onClick:r},[g()])])])};return()=>t.fixed&&t.placeholder?a(l):l()}});const lt=S(nt),at={setup(){const t=x(),e=x(),i=x(),n=x();let a="collection_3_1133718572_31_0";a=N().query.id,console.log(a);const r=x(),c=x();return{onClickLeft:()=>history.back(),audiox:t,h:e,p:i,imgx:n,lrcList:r,container:c,LRCData:"",id:a,lrc:`[00:00.00]xxxxxxx
[00:02.25]x：xx
[00:04.51]x：xx
`,doms:{lrcList:r,container:c},last:[]}},computed:{querySearch(){return this.$route.query.id}},methods:{parseLRC:function(t){let e=null;e=t.split(`
`);let i=[];return e.forEach(n=>{let a=n.split("]"),s=a[0].slice(1).trim(),r={time:Number(this.parseTime(s)),word:a[1]};i.push(r)}),i},parseTime:function(t){let e=t.split(":");return Number(e[0])*60+Number(e[1])},findIndex:function(){let t=-1,e=this.audiox.currentTime;for(let i=0;i<=this.LRCData.length-1;i++)if(e<this.LRCData[i].time)return t=i-1,t;return t=this.LRCData.length-1,t},createLrcList:function(t){let e=document.createDocumentFragment();this.doms.lrcList.value.innerHTML="",t.forEach(i=>{let n=document.createElement("li");n.innerHTML=i.word,e.appendChild(n)}),this.doms.lrcList.value.appendChild(e)},setOffset:function(t){let e=-1*(t*this.doms.lrcList.value.children[0].clientHeight+this.doms.lrcList.value.children[0].clientHeight/2-this.doms.container.value.clientHeight/2);this.doms.lrcList.value.style.transform=`translateY(${e}px)`},setLight:function(t){let i=this.doms.lrcList.value.children,n=document.querySelector(".current");n&&n.classList.remove("current"),i[t].classList.add("current")},start:function(t){this.LRCData=this.parseLRC(t),this.createLrcList(this.LRCData),this.doms.lrcList.value.style.transform=`translateY(${-1*(this.doms.lrcList.value.children[0].clientHeight/2-this.doms.container.clientHeight/2)}px)`},axiosx:function(){let t=this;if(t.lasi<this.last.length-1){t.lasi++;var e=t.last[t.lasi];if(t.lasi>=0){t.audiox.src=e.song_url,t.h.innerHTML=e.title,t.p.innerHTML=`歌手：${e.singer}`,t.imgx.src=e.song_cover,t.lrc=e.lyrics,t.audiox.pause(),t.audiox.play(),t.start(t.lrc);let i=t.setOffset,n=t.setLight,a=t.findIndex;t.audiox.addEventListener("timeupdate",function(){let s=a();n(s),i(s)})}}else T.get(`https://www.hhlqilongzhu.cn/api/dg_kglist.php?id=${this.id}`).then(i=>{this.last.push(i.data),this.audiox.src=i.data.song_url,this.h.innerHTML=i.data.title,this.p.innerHTML=`歌手：${i.data.singer}`,this.imgx.src=i.data.song_cover,this.lrc=i.data.lyrics,this.audiox.pause(),this.audiox.play(),this.start(this.lrc);let n=this.setOffset,a=this.setLight,s=this.findIndex;this.audiox.addEventListener("timeupdate",function(){let r=s();a(r),n(r)})})},left:function(){var t=this.h.innerHTML;console.log(t);let e=this;console.log(e.last),console.log(e.lasi);for(let n=0;n<e.last.length;n++)e.last[n].title==t&&(e.lasi=n,console.log(n));console.log(e.lasi-1);var i=this.last[e.lasi-1];if(e.lasi>=1){e.lasi--,e.audiox.src=i.song_url,e.h.innerHTML=i.title,e.p.innerHTML=`歌手：${i.singer}`,e.imgx.src=i.song_cover,e.lrc=i.lyrics,e.audiox.pause(),e.audiox.play(),e.start(e.lrc);let n=e.setOffset,a=e.setLight,s=e.findIndex;e.audiox.addEventListener("timeupdate",function(){let r=s();a(r),n(r)})}}},mounted(){let t=this;T.get(`https://www.hhlqilongzhu.cn/api/dg_kglist.php?id=${t.id}`).then(n=>{t.last.push(n.data),t.audiox.src=n.data.song_url,t.h.innerHTML=n.data.title,t.p.innerHTML=`歌手：${n.data.singer}`,t.imgx.src=n.data.song_cover,t.lrc=n.data.lyrics,t.audiox.pause(),t.audiox.play(),t.start(t.lrc);let a=t.setOffset,s=t.setLight,r=t.findIndex;t.audiox.addEventListener("timeupdate",function(){let c=r();s(c),a(c)})});let e=!1;function i(){e||(e=!0,T.get(`https://www.hhlqilongzhu.cn/api/dg_kglist.php?id=${t.id}`).then(n=>{t.last.push(n.data),t.audiox.src=n.data.song_url,t.h.innerHTML=n.data.title,t.p.innerHTML=`歌手：${n.data.singer}`,t.imgx.src=n.data.song_cover,t.lrc=n.data.lyrics,t.audiox.pause(),t.audiox.play(),t.start(t.lrc);let a=t.setOffset,s=t.setLight,r=t.findIndex;t.audiox.addEventListener("timeupdate",function(){let c=r();s(c),a(c)})}),setTimeout(()=>{e=!1},600))}t.audiox.addEventListener("ended",function(){i()})}},st={src:"",alt:"",class:"imgx",ref:"imgx"},rt={class:"new"},ot={ref:"h"},ct={ref:"p"},dt=d("img",{src:"",alt:""},null,-1),ut={class:"container",id:"container",ref:"container"},ft={class:"lrcList",id:"lrcList",ref:"lrcList"},ht=d("li",null,null,-1),xt={class:"current",ref:"current"},gt=d("br",null,null,-1),mt={class:"music"},Lt={src:"",controls:"controls",style:{width:"100%"},ref:"audiox",class:"audiox"};function _t(t,e,i,n,a,s){const r=lt,c=tt,g=k;return Y(),F(V,null,[o(r,{title:"标题","left-text":"返回","left-arrow":"",onClickLeft:n.onClickLeft,ref:"titx"},null,8,["onClickLeft"]),o(c,{plain:"",icon:"arrow-left",type:"primary",size:"large",class:"lx",onClick:e[0]||(e[0]=l=>s.left())}),o(c,{plain:"",icon:"arrow",type:"primary",size:"large",class:"rx",onClick:e[1]||(e[1]=l=>s.axiosx())}),o(g,{name:"like-o",class:"like",size:"25px",onClick:e[2]||(e[2]=l=>t.like())}),d("img",st,null,512),d("div",rt,[d("div",null,U(this.$route.params.alert),1),d("h2",ot,null,512),d("p",ct,null,512)]),dt,d("div",ut,[d("ul",ft,[ht,d("li",xt,null,512)],512)],512),gt,d("div",mt,[d("audio",Lt,null,512)])],64)}const Ct=A(at,[["render",_t]]);export{Ct as default};

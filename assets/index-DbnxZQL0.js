import{e as ve,c as q,t as O,n as W,m as Y,u as fe,T as de,b as he,A as K,f as _,p as ge,C as me,D as we,U as k,w as j,a as Te}from"./index-DUQinITR.js";import{T as U,o as be}from"./on-popup-reopen-CfMTDHny.js";import{g as pe,r as p,d as G,h as J,a as T,i as z,p as Q,q as ye,k as xe,l as Se,c as D,n as Z}from"./index-VIYt-XGq.js";function ee(t){const u=pe();u&&ve(u.proxy,t)}function Ce(t,u){return t>u?"horizontal":u>t?"vertical":""}function Pe(){const t=p(0),u=p(0),f=p(0),o=p(0),s=p(0),e=p(0),d=p(""),c=p(!0),b=()=>d.value==="vertical",v=()=>d.value==="horizontal",i=()=>{f.value=0,o.value=0,s.value=0,e.value=0,d.value="",c.value=!0};return{move:m=>{const x=m.touches[0];f.value=(x.clientX<0?0:x.clientX)-t.value,o.value=x.clientY-u.value,s.value=Math.abs(f.value),e.value=Math.abs(o.value);const S=10;(!d.value||s.value<S&&e.value<S)&&(d.value=Ce(s.value,e.value)),c.value&&(s.value>U||e.value>U)&&(c.value=!1)},start:m=>{i(),t.value=m.touches[0].clientX,u.value=m.touches[0].clientY},reset:i,startX:t,startY:u,deltaX:f,deltaY:o,offsetX:s,offsetY:e,direction:d,isVertical:b,isHorizontal:v,isTap:c}}const[te,$]=q("swipe"),Ae={loop:O,width:W,height:W,vertical:Boolean,autoplay:Y(0),duration:Y(500),touchable:O,lazyRender:Boolean,initialSwipe:Y(0),indicatorColor:String,showIndicators:O,stopPropagation:O},ae=Symbol(te);var Ee=G({name:te,props:Ae,emits:["change","dragStart","dragEnd"],setup(t,{emit:u,slots:f}){const o=p(),s=p(),e=J({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let d=!1;const c=Pe(),{children:b,linkChildren:v}=fe(ae),i=T(()=>b.length),r=T(()=>e[t.vertical?"height":"width"]),h=T(()=>t.vertical?c.deltaY.value:c.deltaX.value),m=T(()=>e.rect?(t.vertical?e.rect.height:e.rect.width)-r.value*i.value:0),x=T(()=>r.value?Math.ceil(Math.abs(m.value)/r.value):i.value),S=T(()=>i.value*r.value),C=T(()=>(e.active+i.value)%i.value),R=T(()=>{const a=t.vertical?"vertical":"horizontal";return c.direction.value===a}),ie=T(()=>{const a={transitionDuration:`${e.swiping?0:t.duration}ms`,transform:`translate${t.vertical?"Y":"X"}(${+e.offset.toFixed(2)}px)`};if(r.value){const l=t.vertical?"height":"width",n=t.vertical?"width":"height";a[l]=`${S.value}px`,a[n]=t[n]?`${t[n]}px`:""}return a}),ne=a=>{const{active:l}=e;return a?t.loop?k(l+a,-1,i.value):k(l+a,0,x.value):l},B=(a,l=0)=>{let n=a*r.value;t.loop||(n=Math.min(n,-m.value));let w=l-n;return t.loop||(w=k(w,m.value,0)),w},y=({pace:a=0,offset:l=0,emitChange:n})=>{if(i.value<=1)return;const{active:w}=e,g=ne(a),I=B(g,l);if(t.loop){if(b[0]&&I!==m.value){const X=I<m.value;b[0].setOffset(X?S.value:0)}if(b[i.value-1]&&I!==0){const X=I>0;b[i.value-1].setOffset(X?-S.value:0)}}e.active=g,e.offset=I,n&&g!==w&&u("change",C.value)},M=()=>{e.swiping=!0,e.active<=-1?y({pace:i.value}):e.active>=i.value&&y({pace:-i.value})},le=()=>{M(),c.reset(),_(()=>{e.swiping=!1,y({pace:-1,emitChange:!0})})},N=()=>{M(),c.reset(),_(()=>{e.swiping=!1,y({pace:1,emitChange:!0})})};let H;const A=()=>clearTimeout(H),E=()=>{A(),+t.autoplay>0&&i.value>1&&(H=setTimeout(()=>{N(),E()},+t.autoplay))},P=(a=+t.initialSwipe)=>{if(!o.value)return;const l=()=>{var n,w;if(!K(o)){const g={width:o.value.offsetWidth,height:o.value.offsetHeight};e.rect=g,e.width=+((n=t.width)!=null?n:g.width),e.height=+((w=t.height)!=null?w:g.height)}i.value&&(a=Math.min(i.value-1,a),a===-1&&(a=i.value-1)),e.active=a,e.swiping=!0,e.offset=B(a),b.forEach(g=>{g.setOffset(0)}),E()};K(o)?Z().then(l):l()},F=()=>P(e.active);let L;const oe=a=>{!t.touchable||a.touches.length>1||(c.start(a),d=!1,L=Date.now(),A(),M())},se=a=>{t.touchable&&e.swiping&&(c.move(a),R.value&&(!t.loop&&(e.active===0&&h.value>0||e.active===i.value-1&&h.value<0)||(ge(a,t.stopPropagation),y({offset:h.value}),d||(u("dragStart",{index:C.value}),d=!0))))},V=()=>{if(!t.touchable||!e.swiping)return;const a=Date.now()-L,l=h.value/a;if((Math.abs(l)>.25||Math.abs(h.value)>r.value/2)&&R.value){const w=t.vertical?c.offsetY.value:c.offsetX.value;let g=0;t.loop?g=w>0?h.value>0?-1:1:0:g=-Math[h.value>0?"ceil":"floor"](h.value/r.value),y({pace:g,emitChange:!0})}else h.value&&y({pace:0});d=!1,e.swiping=!1,u("dragEnd",{index:C.value}),E()},ce=(a,l={})=>{M(),c.reset(),_(()=>{let n;t.loop&&a===i.value?n=e.active===0?0:a:n=a%i.value,l.immediate?_(()=>{e.swiping=!1}):e.swiping=!1,y({pace:n-e.active,emitChange:!0})})},ue=(a,l)=>{const n=l===C.value,w=n?{backgroundColor:t.indicatorColor}:void 0;return D("i",{style:w,class:$("indicator",{active:n})},null)},re=()=>{if(f.indicator)return f.indicator({active:C.value,total:i.value});if(t.showIndicators&&i.value>1)return D("div",{class:$("indicators",{vertical:t.vertical})},[Array(i.value).fill("").map(ue)])};return ee({prev:le,next:N,state:e,resize:F,swipeTo:ce}),v({size:r,props:t,count:i,activeIndicator:C}),z(()=>t.initialSwipe,a=>P(+a)),z(i,()=>P(e.active)),z(()=>t.autoplay,E),z([me,we,()=>t.width,()=>t.height],F),z(de(),a=>{a==="visible"?E():A()}),Q(P),ye(()=>P(e.active)),be(()=>P(e.active)),xe(A),Se(A),he("touchmove",se,{target:s}),()=>{var a;return D("div",{ref:o,class:$()},[D("div",{ref:s,style:ie.value,class:$("track",{vertical:t.vertical}),onTouchstartPassive:oe,onTouchend:V,onTouchcancel:V},[(a=f.default)==null?void 0:a.call(f)]),re()])}}});const $e=j(Ee),[Ie,ze]=q("swipe-item");var De=G({name:Ie,setup(t,{slots:u}){let f;const o=J({offset:0,inited:!1,mounted:!1}),{parent:s,index:e}=Te(ae);if(!s)return;const d=T(()=>{const v={},{vertical:i}=s.props;return s.size.value&&(v[i?"height":"width"]=`${s.size.value}px`),o.offset&&(v.transform=`translate${i?"Y":"X"}(${o.offset}px)`),v}),c=T(()=>{const{loop:v,lazyRender:i}=s.props;if(!i||f)return!0;if(!o.mounted)return!1;const r=s.activeIndicator.value,h=s.count.value-1,m=r===0&&v?h:r-1,x=r===h&&v?0:r+1;return f=e.value===r||e.value===m||e.value===x,f}),b=v=>{o.offset=v};return Q(()=>{Z(()=>{o.mounted=!0})}),ee({setOffset:b}),()=>{var v;return D("div",{class:ze(),style:d.value},[c.value?(v=u.default)==null?void 0:v.call(u):null])}}});const Xe=j(De);export{$e as S,Xe as a,Pe as b,ee as u};
